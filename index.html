<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© - SPAS</title>
    <style>
        /* ==================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ==================== */
        :root {
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ§ØªØ­ (Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª) */
            --bg-light: #f0f2f5;
            --text-light-main: #1e293b;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø§ÙƒÙ† (Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ§Øª) */
            --bg-dark: #0f172a;
            --text-dark-main: #f1f5f9;
            --text-dark-muted: #94a3b8;
            
            /* Ø£Ù„ÙˆØ§Ù† Ù…Ø´ØªØ±ÙƒØ© */
            --primary: #6c757d; /* Ø±Ù…Ø§Ø¯ÙŠ */
            
            --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Tahoma, system-ui, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light-main);
            padding-bottom: 80px; overflow-x: hidden;
            transition: background-color 0.3s ease;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex; justify-content: space-around;
            padding: 12px 0; z-index: 5000;
            border-top: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        body.dark-mode .bottom-nav {
            background: rgba(15, 23, 42, 0.95);
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .nav-item {
            background: none; border: none;
            color: #94a3b8; font-size: 0.75rem; font-weight: bold;
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            cursor: pointer; transition: 0.3s;
        }
        .nav-item.active { color: var(--primary); transform: translateY(-2px); }
        .nav-icon { font-size: 1.4rem; }

        .app-section { display: none; animation: fadeIn 0.4s ease; }
        .app-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ==================== 1. ØªØµÙ…ÙŠÙ… Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª ==================== */
        #shift-app {
            background-color: var(--bg-light);
            min-height: 100vh;
        }

        .app-header-shift {
            background: radial-gradient(circle at 50% 100%, #1e293b 0%, #0f172a 100%);
            color: white; padding: 40px 15px 80px 15px; text-align: center;
            border-radius: 0 0 40px 40px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .controls-container { 
            display: flex; gap: 8px; justify-content: space-between; align-items: stretch;
            margin: -35px auto 20px auto; padding: 0 15px; position: relative; z-index: 10; 
        }

        .btn-top-control {
            flex: 1; 
            background: #ffffff; color: #334155; border: none;
            border-radius: 12px; padding: 0 5px; 
            font-weight: 700; font-size: 0.8rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.08);
            display: flex; align-items: center; justify-content: center; gap: 5px;
            cursor: pointer; height: 55px; 
            transition: transform 0.1s;
        }
        .btn-top-control:active { transform: scale(0.98); background: #f8fafc; }

        .groups-summary { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; 
            padding: 0 15px; margin-top: 10px; 
        }
        .group-card { 
            background: white; padding: 15px 5px; border-radius: 18px; 
            text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
        }
        
        .g-circle { 
            width: 32px; height: 32px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: white; font-weight: 900; font-size: 1rem;
        }
        .bg-a { background-color: #1e3a8a; }
        .bg-b { background-color: #b91c1c; }
        .bg-c { background-color: #0f766e; }
        .bg-d { background-color: #7e22ce; }
        .g-score { font-size: 1.4rem; font-weight: 800; color: #1e293b; }

        .month-nav-wrapper {
            display: flex; justify-content: center; align-items: center; gap: 10px;
            margin: 20px 0; background: #e2e8f0; 
            width: fit-content; margin-left: auto; margin-right: auto;
            padding: 5px 15px; border-radius: 15px;
        }
        .month-label { font-size: 1.3rem; font-weight: 800; color: #1e293b; min-width: 120px; text-align: center; }
        .month-arrows-vertical { display: flex; flex-direction: column; gap: 2px; }
        .btn-arrow-v {
            width: 30px; height: 20px; background: white; border: none; border-radius: 5px;
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem; 
            cursor: pointer; color: #334155; box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .schedule-container { width: 92%; margin: 0 auto; border-radius: 20px; overflow: hidden; background: white; box-shadow: var(--shadow-soft); }
        .schedule-table { width: 100%; border-collapse: collapse; text-align: center; }
        .schedule-table th { padding: 15px; color: #64748b; font-size: 0.9rem; border-bottom: 1px solid #f1f5f9; background: #f8fafc; }
        .schedule-table td { padding: 14px 5px; font-weight: 700; border-bottom: 1px solid #f8fafc; font-size: 1rem; }
        
        .row-today { 
            background: linear-gradient(90deg, rgba(108, 117, 125, 0.15) 0%, rgba(255, 255, 255, 0.8) 100%) !important;
            border-right: 4px solid var(--primary) !important;
        }
        .row-today td { color: #000 !important; font-weight: 900 !important; }
        
        .txt-layl { color: #dc2626; } .txt-nahar { color: #1d4ed8; } 

        /* ==================== 2. ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ© ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ§Øª ==================== */
#career-app {
    background-color: var(--bg-dark);
    /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„ØªÙƒÙˆÙ† Ø«Ø§Ø¨ØªØ© ÙˆÙ…Ø±ÙŠØ­Ø© Ù„Ù„Ø¹ÙŠÙ† */
    background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
    background-attachment: fixed;
    min-height: 100vh;
    padding: 30px 20px 100px 20px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙˆØ§Ù„Ø³ÙÙ„ÙŠ */
    color: var(--text-dark-main);
    box-sizing: border-box;
}

        /* Ø£Ø²Ø±Ø§Ø± 3D */
        .btn-3d-action {
            width: 100%; padding: 12px; border: none; border-radius: 12px;
            color: white; font-weight: 700; font-size: 1rem; cursor: pointer;
            transition: all 0.1s; position: relative; top: 0;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        .btn-3d-action:active { top: 3px; box-shadow: 0 1px 0 rgba(0,0,0,0.3); }
        
        .btn-blue { background: linear-gradient(145deg, #3b82f6, #2563eb); box-shadow: 0 4px 0 #1e40af; }
        .btn-red { background: linear-gradient(145deg, #ef4444, #dc2626); box-shadow: 0 4px 0 #991b1b; }
        .btn-dark-3d { background: #334155; color: #cbd5e1; box-shadow: 0 4px 0 #0f172a; }

        /* Ù…Ø¯Ø®Ù„Ø§Øª Ø¹ØµØ±ÙŠØ© Ø¯Ø§ÙƒÙ†Ø© */
        .modern-input {
            width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #475569;
            background: #020617; color: white; text-align: center; font-size: 1rem; font-weight: bold;
            box-sizing: border-box;
        }
        .modern-input:focus { border-color: var(--primary); outline: none; }

        .career-tabs { background: #020617; padding: 5px; border-radius: 14px; display: flex; gap: 10px; margin-bottom: 20px; border: 1px solid #1e293b; }
        .c-tab-btn { flex: 1; padding: 10px; border: none; border-radius: 10px; background: transparent; color: #94a3b8; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .c-tab-btn.active { background: #1e293b; color: var(--primary); border: 1px solid #334155; }

        .sg-card { background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }

        .medals-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .medal-card { background: #1e293b; border: 1px solid #334155; border-radius: 14px; padding: 15px; text-align: center; }
        .medal-card.active { border: 1px solid #10b981; background: rgba(16, 185, 129, 0.05); }
        .medal-icon { font-size: 2.2rem; margin-bottom: 5px; display: block; }
        .medal-progress-bar { height: 5px; width: 60%; margin: 10px auto 0; background: #0f172a; border-radius: 10px; overflow: hidden; }
        .medal-progress-fill { height: 100%; border-radius: 10px; }

        /* ==================== 3. Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª ==================== */
        .modal { display: none; position: fixed; z-index: 6000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); align-items: center; justify-content: center; }
        .modal-box-light { background: #f8fafc; padding: 25px; border-radius: 25px; width: 90%; max-width: 350px; max-height: 80vh; overflow-y: auto; color: #334155; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .modal-box-dark { background: #1e293b; padding: 25px; border-radius: 24px; width: 90%; max-width: 400px; max-height: 85vh; overflow-y: auto; color: #f1f5f9; border: 1px solid #475569; box-shadow: 0 25px 60px rgba(0,0,0,0.7); }

        /* Ø¹Ù†ØµØ± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ */
        .worker-item-light {
            background: white; padding: 12px; margin-bottom: 8px; border-radius: 12px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;
        }

        .promo-card-item { 
            background: #0f172a; border-radius: 16px; padding: 15px; margin-bottom: 12px; 
            display: flex; justify-content: space-between; align-items: center; 
            border-right: 4px solid #10b981; border-left: 1px solid #334155; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        .promo-actions-container { display: flex; gap: 8px; }
        .btn-action-mini {
            padding: 6px 12px; border-radius: 8px; border: none; font-weight: 700; font-size: 0.8rem;
            cursor: pointer; display: flex; align-items: center; gap: 4px; color: white;
            transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .btn-action-mini:active { transform: translateY(2px); }

        .add-promo-box { background: #0f172a; border-radius: 20px; padding: 20px; margin-top: 25px; border: 1px solid #334155; box-shadow: inset 0 2px 10px rgba(0,0,0,0.3); }

        .form-label-dark { display: block; text-align: center; color: var(--primary); font-size: 0.9rem; font-weight: 800; margin-bottom: 8px; }

    </style>
</head>
<body>

    <div id="shift-app" class="app-section active">
        <div class="app-header-shift">
            <h1 style="margin:0; font-size:1.8rem; font-weight:800;">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</h1>
            <p style="margin:8px 0 0 0; opacity:0.9; font-size:0.95rem; font-weight:bold; line-height:1.4;">
                Ø´Ø±ÙƒØ© Ø£Ù…Ù† ÙˆØ±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© ÙˆØ§Ù„ØºØ§Ø²ÙŠØ©<br>
                <span style="font-weight:900; color:var(--primary); font-size:1.3rem; letter-spacing:2px; display:inline-block; margin-top:3px;">SPAS</span>
            </p>
        </div>

        <div class="controls-container">
            <button class="btn-top-control" onclick="openWorkersList()">ğŸ“ˆ ØªØ±Ù‚ÙŠØ§Øª Ø§Ù„Ø¹Ù…Ø§Ù„</button>
            <button class="btn-top-control" onclick="openSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            <button class="btn-top-control" onclick="goToCurrentMonth()">ğŸ“… Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</button>
        </div>

        <div class="groups-summary">
            <div class="group-card"><div class="g-circle bg-a">Ø£</div><div class="g-score" id="total-a">0</div></div>
            <div class="group-card"><div class="g-circle bg-b">Ø¨</div><div class="g-score" id="total-b">0</div></div>
            <div class="group-card"><div class="g-circle bg-c">Ø¬</div><div class="g-score" id="total-c">0</div></div>
            <div class="group-card"><div class="g-circle bg-d">Ø¯</div><div class="g-score" id="total-d">0</div></div>
        </div>

        <div class="month-nav-wrapper">
            <div class="month-label" id="monthDisplay">--</div>
            <div class="month-arrows-vertical">
                <button class="btn-arrow-v" onclick="changeMonth(1)">â–²</button>
                <button class="btn-arrow-v" onclick="changeMonth(-1)">â–¼</button>
            </div>
        </div>

        <div class="schedule-container" id="scheduleTableContainer">
            <table class="schedule-table">
                <thead><tr><th>#</th><th>Ø£</th><th>Ø¨</th><th>Ø¬</th><th>Ø¯</th></tr></thead>
                <tbody id="calendarBody"></tbody>
            </table>
        </div>
    </div>

    <div id="career-app" class="app-section">
        <div style="text-align:center; margin-bottom:20px;">
            <h1 style="margin:0; background: linear-gradient(to bottom, #fff, #6c757d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size:2rem; font-weight:900;">SONELGAZ</h1>
            <p style="margin:2px 0 0 0; color:var(--primary); font-weight:800; font-size:1.2rem; letter-spacing:3px; opacity:0.8;">SPAS</p>
        </div>

        <div class="career-tabs">
            <button id="tab-view" class="c-tab-btn active" onclick="switchCareerTab('view')">Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆØ³Ù…Ø©</button>
            <button id="tab-admin" class="c-tab-btn" onclick="switchCareerTab('admin')">Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„</button>
        </div>

        <div id="page-view" style="display:block;">
            <div class="sg-card">
                <label style="display:block; text-align:center; color:#94a3b8; margin-bottom:10px; font-weight:bold;">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù:</label>
                <select id="worker-select" class="modern-input" onchange="loadCareerData()"></select>
            </div>

            <div id="career-results" style="display:none;">
                <div class="sg-card" style="text-align:center; border-bottom: 4px solid var(--primary);">
                    <h2 id="res-name" style="margin:0; color:white; font-size:1.5rem;"></h2>
                    <h1 id="res-years" style="color:var(--text-dark-main); font-size:3.5rem; margin:10px 0; font-weight:800;">0 Ø³Ù†Ø©</h1>
                    <p id="res-detail" style="color:#94a3b8; margin:0; font-size:1.1rem;"></p>
                </div>

                <h3 style="color:var(--text-dark-main); text-align:center; margin:20px 0;">Ø³Ø§Ø­Ø© Ø§Ù„Ø£ÙˆØ³Ù…Ø© Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ÙŠØ©</h3>
                <div id="medals-grid" class="medals-grid"></div>

                <div class="sg-card" style="margin-top:20px; text-align:center; background:rgba(15, 23, 42, 0.8);">
                    <h4 style="margin:0 0 10px 0; color:var(--text-dark-main)">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (Ø³Ù† 60)</h4>
                    <div id="retire-date" style="font-family:monospace; font-size:1.5rem; letter-spacing:2px; color:white;"></div>
                    <div id="retire-countdown" style="margin-top:10px; font-weight:bold; color:#cbd5e1;"></div>
                </div>
            </div>
        </div>

        <div id="page-admin" style="display:none;">
            <div class="sg-card">
                <h3 style="color:var(--text-dark-main); text-align:center;">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
                <input type="text" id="in-name" class="modern-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <div style="flex:1;">
                        <label style="display:block; text-align:center; color:#94a3b8; font-size:0.9rem; font-weight:bold; margin-bottom:5px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                        <input type="date" id="in-birth" class="modern-input">
                    </div>
                    <div style="flex:1;">
                        <label style="display:block; text-align:center; color:#94a3b8; font-size:0.9rem; font-weight:bold; margin-bottom:5px;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
                        <input type="date" id="in-rec" class="modern-input">
                    </div>
                </div>

                <label style="display:block; text-align:center; font-size:0.9rem; color:#94a3b8; margin-top:15px;">Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© / Ø§Ù„Ø£Ù‚Ø¯Ù…ÙŠØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</label>
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <input type="number" id="in-mil-y" class="modern-input" placeholder="Ø³Ù†Ø©">
                    <input type="number" id="in-mil-m" class="modern-input" placeholder="Ø´Ù‡Ø±">
                    <input type="number" id="in-mil-d" class="modern-input" placeholder="ÙŠÙˆÙ…">
                </div>
                <button class="btn-3d-action btn-dark-3d" style="margin-top:20px;" onclick="saveCareerWorker()">Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
            <div id="admin-list" style="padding-bottom:100px;"></div>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchApp('shift'); scrollToToday();">
            <span class="nav-icon">ğŸ“…</span>
            <span>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</span>
        </button>
        <button class="nav-item" onclick="switchApp('career')">
            <span class="nav-icon">ğŸ…</span>
            <span>Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ©</span>
        </button>
    </nav>

    <div id="workersListModal" class="modal">
        <div class="modal-box-light">
            <h3 style="text-align:center; margin-bottom:15px; color:#1e3a8a;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
            <div id="workersListSimpleContainer" style="max-height:300px; overflow-y:auto; padding-right:5px;"></div>
            <button class="btn-top-control" style="width:100%; margin-top:10px; background:#10b981; color:white;" onclick="addNewWorkerPrompt()">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn-top-control" style="width:100%; margin-top:10px; background:#e2e8f0;" onclick="document.getElementById('workersListModal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="workerPromoModal" class="modal">
        <div class="modal-box-dark">
            <div style="text-align:center; margin-bottom:20px;">
                <h2 id="wh-workerName" style="margin:0; color:white;">Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</h2>
                <p style="margin:5px 0 0 0; font-size:0.85rem; color:#64748b;">Ø³Ø¬Ù„ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù‡Ù†ÙŠ</p>
            </div>
            <div id="wh-list" style="background:white; padding:10px; border-radius:15px; min-height:100px; max-height:200px; overflow-y:auto;"></div>

            <div class="add-promo-box">
                <h4 id="formTitle" style="text-align:center; color:#3b82f6; margin:0 0 10px 0;">Ø¥Ø¶Ø§ÙØ© ØªØ±Ù‚ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h4>
                <div style="display:flex; gap:10px;">
                    <div style="flex:1;">
                        <label style="font-size:0.8rem; color:#64748b; font-weight:bold; display:block; text-align:center;">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="wh-date" class="promo-field">
                    </div>
                </div>
                <div style="display:flex; gap:10px;">
                    <div style="flex:1;">
                        <label style="font-size:0.8rem; color:#6c757d; font-weight:bold; display:block; text-align:center;">Ø§Ù„Ø¯Ø±Ø¬Ø© CATÃ‰GORIE</label>
                        <select id="wh-cat" class="promo-field"></select>
                    </div>
                    <div style="flex:1;">
                        <label style="font-size:0.8rem; color:#6c757d; font-weight:bold; display:block; text-align:center;">Ø§Ù„ØµÙ†Ù CLASSE</label>
                        <select id="wh-ech" class="promo-field"></select>
                    </div>
                </div>
                <button id="btnSavePromo" class="btn-3d-action btn-dark-3d" style="margin-top:15px;" onclick="saveWorkerPromo()">+ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ±Ù‚ÙŠØ©</button>
                <button id="btnCancelEdit" class="btn-3d-action btn-red" style="margin-top:5px; display:none;" onclick="resetPromoForm()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
            <button class="btn-top-control" style="width:100%; margin-top:10px;" onclick="document.getElementById('workerPromoModal').style.display='none'">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-box-light">
            <h3 style="text-align:center; color:#1e293b;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø©</h3>
            <div id="settingsInputs"></div>
            <button class="btn-top-control" style="width:100%; margin-top:15px; background:#10b981; color:white;" onclick="saveSettings()">Ø­ÙØ¸</button>
            <button class="btn-top-control" style="width:100%; margin-top:10px; background:#e2e8f0;" onclick="document.getElementById('settingsModal').style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script>
        /* ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ==================== */
        function parseDateSafe(dateStr) {
            if (!dateStr) return new Date();
            if (dateStr.includes('/')) {
                const parts = dateStr.split('/');
                if (parts.length === 3) return new Date(parts[2], parts[1] - 1, parts[0]);
            }
            return new Date(dateStr);
        }

        function setDateConstraints() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const recInput = document.getElementById('in-rec');
            if (recInput) recInput.setAttribute('max', todayStr);
            const birthInput = document.getElementById('in-birth');
            if (birthInput) {
                const minAgeDate = new Date();
                minAgeDate.setFullYear(today.getFullYear() - 18);
                const maxBirthStr = minAgeDate.toISOString().split('T')[0];
                birthInput.setAttribute('max', maxBirthStr);
            }
        }

        /* ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==================== */
        function switchApp(appName) {
            document.querySelectorAll('.app-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            if(appName === 'shift') {
                document.getElementById('shift-app').classList.add('active');
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                document.body.className = ''; 
            } else {
                document.getElementById('career-app').classList.add('active');
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                document.body.className = 'dark-mode'; 
                switchCareerTab('view'); 
                if(careerWorkers.length > 0) {
                    const select = document.getElementById('worker-select');
                    if(!select.value) {
                        select.value = careerWorkers[0].id;
                        loadCareerData();
                    }
                }
                setDateConstraints();
            }
        }

        /* ==================== Ù…Ù†Ø·Ù‚ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª ==================== */
        const SHIFTS = [{code:0, label:'Ù†Ù‡Ø§Ø±', class:'txt-nahar'}, {code:1, label:'Ù„ÙŠÙ„', class:'txt-layl'}, {code:2, label:'Ø±1', class:''}, {code:3, label:'Ø±2', class:''}];
        const monthNames = ["Ø¬Ø§Ù†ÙÙŠ", "ÙÙŠÙØ±ÙŠ", "Ù…Ø§Ø±Ø³", "Ø£ÙØ±ÙŠÙ„", "Ù…Ø§ÙŠ", "Ø¬ÙˆØ§Ù†", "Ø¬ÙˆÙŠÙ„ÙŠØ©", "Ø£ÙˆØª", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();
        let groupConfig = { A: 2, B: 1, C: 0, D: 3 }; 
        let referenceDate = new Date(2026, 0, 14); referenceDate.setHours(0,0,0,0);
        let workersData = [];
        let currentWorkerIndex = null;
        let editingHistoryIndex = -1;

        function initShiftSystem() {
            const savedShift = localStorage.getItem('shiftData_SPAS_2026');
            if(savedShift) { 
                const data = JSON.parse(savedShift); 
                groupConfig = data.config; 
                referenceDate = new Date(data.refDate); 
            }
            
            const savedWorkers = localStorage.getItem('workersData_v3');
            if(savedWorkers) { workersData = JSON.parse(savedWorkers).list || []; }
            if(workersData.length === 0) for(let i=1; i<=30; i++) workersData.push({ id: i, name: `Ø¹Ø§Ù…Ù„ ${i}`, history: [] });

            renderCalendar();
            
            const categories = ['5','6','7','8','9','10','11','12','13','14','14A','15','15A','16','17','18','19','20','21','22','U1','U2','U3','U4','U5','U6','U7','U8','U9'];
            let catHTML = ''; categories.forEach(c => { catHTML += `<option value="${c}">${c}</option>`; });
            document.getElementById('wh-cat').innerHTML = catHTML;

            let echHTML = '';
            for(let i=0; i<=10; i++) {
                let val = (i === 0) ? 'R' : (i === 10 ? 'C' : i);
                echHTML += `<option value="${val}">${val}</option>`;
            }
            document.getElementById('wh-ech').innerHTML = echHTML;
        }

        function renderCalendar() {
            const tbody = document.getElementById('calendarBody'); tbody.innerHTML = '';
            document.getElementById('monthDisplay').innerText = `${monthNames[currentMonth]} ${currentYear}`;
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date(); today.setHours(0,0,0,0);
            let counters = {A:0,B:0,C:0,D:0};

            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(currentYear, currentMonth, day);
                const diff = Math.round((dateObj.getTime() - referenceDate.getTime()) / 86400000);
                const getS = (cfg) => { let idx = (cfg + diff) % 4; while (idx < 0) idx += 4; return SHIFTS[idx]; };
                const s = { A: getS(groupConfig.A), B: getS(groupConfig.B), C: getS(groupConfig.C), D: getS(groupConfig.D) };
                
                ['A','B','C','D'].forEach(g => {
                    if(s[g].code === 1) counters[g] += 2; else if(s[g].code === 0) counters[g] += 1;
                });
                
                const tr = document.createElement('tr');
                if(dateObj.getTime() === today.getTime()) { tr.className = 'row-today'; tr.id = 'todayRow'; }
                tr.innerHTML = `<td>${day}</td><td class="${s.A.class}">${s.A.label}</td><td class="${s.B.class}">${s.B.label}</td><td class="${s.C.class}">${s.C.label}</td><td class="${s.D.class}">${s.D.label}</td>`;
                tbody.appendChild(tr);
            }
            ['A','B','C','D'].forEach(g => document.getElementById(`total-${g.toLowerCase()}`).innerText = counters[g]);
        }

        function changeMonth(s) { currentMonth += s; if(currentMonth > 11) { currentMonth=0; currentYear++; } else if(currentMonth < 0) { currentMonth=11; currentYear--; } renderCalendar(); }
        function goToCurrentMonth() { const n = new Date(); currentMonth = n.getMonth(); currentYear = n.getFullYear(); renderCalendar(); scrollToToday(); }
        function scrollToToday() { setTimeout(() => { const t = document.getElementById('todayRow'); if(t) t.scrollIntoView({ behavior: 'smooth', block: 'center' }); else document.getElementById('scheduleTableContainer').scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 300); }

        function openWorkersList() {
            const container = document.getElementById('workersListSimpleContainer'); container.innerHTML = '';
            workersData.forEach((w, i) => {
                container.innerHTML += `
                <div class="worker-item-light" style="padding:10px; display:flex; align-items:center; gap:10px;">
                    <div style="flex:1; cursor:pointer;" onclick="openWorkerHistory(${i})">
                        <span style="font-weight:700; color:#334155;">${w.name || 'Ø¹Ø§Ù…Ù„ ' + w.id}</span>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn-action-mini btn-blue" onclick="editWorkerName(${i})">âœï¸</button>
                        <button class="btn-action-mini btn-red" onclick="deleteWorker(${i})">ğŸ—‘ï¸</button>
                    </div>
                </div>`;
            });
            document.getElementById('workersListModal').style.display = 'flex';
        }

        function addNewWorkerPrompt() {
            const name = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
            if (name && name.trim() !== "") {
                const newId = workersData.length > 0 ? Math.max(...workersData.map(w => w.id)) + 1 : 1;
                workersData.push({ id: newId, name: name.trim(), history: [] });
                saveAllWorkers();
                openWorkersList();
            }
        }

        function editWorkerName(index) {
            const newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:", workersData[index].name);
            if(newName && newName.trim() !== "") {
                workersData[index].name = newName.trim();
                saveAllWorkers();
                openWorkersList();
            }
        }

        function deleteWorker(index) {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§ØªÙ‡.")) {
                workersData.splice(index, 1);
                saveAllWorkers();
                openWorkersList();
            }
        }

        function openWorkerHistory(index) {
            currentWorkerIndex = index;
            document.getElementById('workersListModal').style.display = 'none';
            document.getElementById('wh-workerName').innerText = workersData[index].name;
            resetPromoForm();
            renderHistoryList();
            document.getElementById('workerPromoModal').style.display = 'flex';
        }

        function renderHistoryList() {
            const list = document.getElementById('wh-list'); list.innerHTML = '';
            const history = workersData[currentWorkerIndex].history || [];
            if(history.length === 0) { list.innerHTML = '<p style="text-align:center; color:#94a3b8; font-size:0.9rem; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</p>'; return; }
            history.sort((a,b) => new Date(b.date) - new Date(a.date));

            history.forEach((h, i) => {
                const div = document.createElement('div');
                div.className = 'promo-card-item';
                div.innerHTML = `
                    <div class="promo-actions-container">
                        <button class="btn-action-mini btn-blue" style="background:#3b82f6" onclick="editHistoryItem(${i})">âœ</button>
                        <button class="btn-action-mini btn-red" style="background:#ef4444" onclick="deleteHistoryItem(${i})">âœ–</button>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:0.85rem; color:#94a3b8;">${h.date}</div>
                        <div style="font-size:0.95rem; font-weight:700; color:#f1f5f9;">CAT: ${h.cat} | CLS: ${h.ech}</div>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function deleteHistoryItem(histIndex) {
            if(confirm("Ø­Ø°ÙØŸ")) {
                workersData[currentWorkerIndex].history.splice(histIndex, 1);
                saveAllWorkers(); renderHistoryList();
            }
        }

        function editHistoryItem(index) {
            const h = workersData[currentWorkerIndex].history[index];
            document.getElementById('wh-date').value = h.date;
            document.getElementById('wh-cat').value = h.cat;
            document.getElementById('wh-ech').value = h.ech;
            editingHistoryIndex = index;
            document.getElementById('formTitle').innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ±Ù‚ÙŠØ©";
            document.getElementById('btnSavePromo').innerText = "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
            document.getElementById('btnCancelEdit').style.display = 'inline-block';
        }

        function saveWorkerPromo() {
            const date = document.getElementById('wh-date').value;
            const cat = document.getElementById('wh-cat').value;
            const ech = document.getElementById('wh-ech').value;
            if(!date) return alert("Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®");
            
            const promoData = { date, cat, ech };
            if(!workersData[currentWorkerIndex].history) workersData[currentWorkerIndex].history = [];

            if(editingHistoryIndex === -1) {
                workersData[currentWorkerIndex].history.push(promoData);
            } else {
                workersData[currentWorkerIndex].history[editingHistoryIndex] = promoData;
            }
            
            saveAllWorkers();
            resetPromoForm();
            renderHistoryList();
        }

        function resetPromoForm() {
            editingHistoryIndex = -1;
            document.getElementById('wh-date').valueAsDate = new Date();
            document.getElementById('wh-cat').value = '5'; 
            document.getElementById('wh-ech').value = 'R'; 
            
            document.getElementById('formTitle').innerText = "Ø¥Ø¶Ø§ÙØ© ØªØ±Ù‚ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©";
            document.getElementById('btnSavePromo').innerText = "+ ØªØ³Ø¬ÙŠÙ„";
            document.getElementById('btnCancelEdit').style.display = 'none';
        }

        function saveAllWorkers() { localStorage.setItem('workersData_v3', JSON.stringify({ list: workersData })); }

        function openSettings() {
            document.getElementById('settingsInputs').innerHTML = ['A', 'B', 'C', 'D'].map(g => {
                let selectedVal = groupConfig[g];
                return `<div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:center;">
                    <label style="color:#1e293b; font-weight:700;">ÙÙˆØ¬ ${g}</label>
                    <select id="start${g}" style="padding:8px; border-radius:8px; border:1px solid #cbd5e1;">${SHIFTS.map(s => `<option value="${s.code}" ${s.code===selectedVal?'selected':''}>${s.label}</option>`).join('')}</select>
                </div>`;
            }).join('');
            document.getElementById('settingsModal').style.display = 'flex';
        }
        function saveSettings() {
            ['A','B','C','D'].forEach(g => groupConfig[g] = parseInt(document.getElementById(`start${g}`).value));
            referenceDate = new Date(); referenceDate.setHours(0,0,0,0);
            localStorage.setItem('shiftData_SPAS_2026', JSON.stringify({ config: groupConfig, refDate: referenceDate.getTime() }));
            document.getElementById('settingsModal').style.display='none';
            renderCalendar();
        }

        /* ==================== Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ© ==================== */
        let careerWorkers = JSON.parse(localStorage.getItem('sonelgaz_db')) || [];

        function switchCareerTab(t) {
            document.getElementById('page-view').style.display = t==='view'?'block':'none';
            document.getElementById('page-admin').style.display = t==='admin'?'block':'none';
            document.getElementById('tab-view').className = `c-tab-btn ${t==='view'?'active':''}`;
            document.getElementById('tab-admin').className = `c-tab-btn ${t==='admin'?'active':''}`;
            if(t==='view') {
                const s = document.getElementById('worker-select'); s.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>';
                careerWorkers.forEach(w => s.innerHTML += `<option value="${w.id}">${w.name}</option>`);
            }
            if(t==='admin') renderAdminList();
        }

        function saveCareerWorker() {
            const name = document.getElementById('in-name').value;
            const b = document.getElementById('in-birth').value;
            const r = document.getElementById('in-rec').value;
            const milY = parseInt(document.getElementById('in-mil-y').value)||0;
            const milM = parseInt(document.getElementById('in-mil-m').value)||0;
            const milD = parseInt(document.getElementById('in-mil-d').value)||0;

            if(!name || !b || !r) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");

            const birthDate = new Date(b);
            const recDate = new Date(r);
            const today = new Date();
            today.setHours(0,0,0,0);

            // Ø§Ù„ØªØ­Ù‚Ù‚ 1: ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
            const recCheck = new Date(recDate);
            recCheck.setHours(0,0,0,0);
            if (recCheck > today) {
                alert("Ø®Ø·Ø£: ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„!");
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ 2: Ø§Ù„Ø¹Ù…Ø± Ù„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† 18 Ø³Ù†Ø©
            let age18Today = new Date(birthDate);
            age18Today.setFullYear(age18Today.getFullYear() + 18);
            if (today < age18Today) {
                alert("Ø®Ø·Ø£: Ø§Ù„Ø¹Ø§Ù…Ù„ Ù„Ù… ÙŠØ¨Ù„Øº 18 Ø³Ù†Ø© Ø¨Ø¹Ø¯!");
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ 3: Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙØ¹Ù„ÙŠ
            let workStartDate = new Date(recDate);
            workStartDate.setFullYear(workStartDate.getFullYear() - milY);
            workStartDate.setMonth(workStartDate.getMonth() - milM);
            workStartDate.setDate(workStartDate.getDate() - milD);

            let minAllowedAgeDate = new Date(birthDate);
            minAllowedAgeDate.setFullYear(minAllowedAgeDate.getFullYear() + 18);

            if (workStartDate < minAllowedAgeDate) {
                alert("Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø®Ø¨Ø±Ø© ØªØ¬Ø¹Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ù‚Ø¨Ù„ Ø³Ù† 18 Ø³Ù†Ø©!");
                return;
            }

            careerWorkers.push({ id: Date.now(), name, birth: b, rec: r, milY, milM, milD });
            localStorage.setItem('sonelgaz_db', JSON.stringify(careerWorkers));
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
            document.getElementById('in-name').value = "";
            renderAdminList();
        }

        function renderAdminList() {
            const list = document.getElementById('admin-list'); list.innerHTML = '';
            careerWorkers.forEach(w => {
                list.innerHTML += `<div class="promo-card-item">
                    <button class="btn-action-mini btn-red" style="background:#ef4444" onclick="deleteCareerWorker(${w.id})">âœ–</button>
                    <div style="text-align:right;">
                        <div style="font-weight:700; color:#f1f5f9;">${w.name}</div>
                        <div style="font-size:0.85rem; color:#94a3b8;">${w.rec}</div>
                    </div>
                </div>`;
            });
        }
        function deleteCareerWorker(id) { if(confirm('Ø­Ø°ÙØŸ')) { careerWorkers = careerWorkers.filter(w=>w.id!=id); localStorage.setItem('sonelgaz_db', JSON.stringify(careerWorkers)); renderAdminList(); } }

        function loadCareerData() {
            const id = document.getElementById('worker-select').value;
            if(!id) { document.getElementById('career-results').style.display='none'; return; }
            document.getElementById('career-results').style.display='block';
            const w = careerWorkers.find(x => x.id == id);
            document.getElementById('res-name').innerText = w.name;

            const recDate = parseDateSafe(w.rec);
            const today = new Date();
            let diff = today - recDate;
            let tY = Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25));
            let tM = Math.floor((diff % (1000 * 60 * 60 * 24 * 365.25)) / (1000 * 60 * 60 * 24 * 30.44));
            let tD = Math.floor((diff % (1000 * 60 * 60 * 24 * 30.44)) / (1000 * 60 * 60 * 24));
            
            tY += w.milY; tM += w.milM; tD += w.milD;
            if(tD >= 30) { tD -= 30; tM++; } if(tM >= 12) { tM -= 12; tY++; }

            document.getElementById('res-years').innerText = `${tY} Ø³Ù†Ø©`;
            document.getElementById('res-detail').innerText = `${tM} Ø´Ù‡Ø± Ùˆ ${tD} ÙŠÙˆÙ… Ø£Ù‚Ø¯Ù…ÙŠØ©`;

            const grid = document.getElementById('medals-grid'); grid.innerHTML = '';
            const medals = [{n:'ÙØ¶ÙŠØ©', y:20, i:'ğŸ¥ˆ', c:'#94a3b8'}, {n:'Ø¨Ø±ÙˆÙ†Ø²ÙŠØ©', y:15, i:'ğŸ¥‰', c:'#cd7f32'}, {n:'Ù‚Ø±Ù…Ø²ÙŠØ©', y:30, i:'ğŸ–ï¸', c:'#e74c3c'}, {n:'Ø°Ù‡Ø¨ÙŠØ©', y:25, i:'ğŸ¥‡', c:'#f1c40f'}, {n:'Ø¯Ø¨Ù„ÙˆÙ… ÙƒØ¨ÙŠØ±', y:40, i:'ğŸ“', c:'#64748b'}, {n:'Ø¯Ø¨Ù„ÙˆÙ…', y:35, i:'ğŸ“œ', c:'#64748b'}];

            medals.forEach(m => {
                let d = new Date(recDate);
                d.setFullYear(d.getFullYear() + m.y - w.milY); d.setMonth(d.getMonth() - w.milM); d.setDate(d.getDate() - w.milD);
                let isDone = today >= d;
                let remTxt = '';
                if(!isDone) {
                    let rDiff = d - today;
                    let rY = Math.floor(rDiff / (1000 * 60 * 60 * 24 * 365.25));
                    let rM = Math.floor((rDiff % (1000 * 60 * 60 * 24 * 365.25)) / (1000 * 60 * 60 * 24 * 30.44));
                    remTxt = `Ù…ØªØ¨Ù‚ÙŠ: ${rY}Ø³ ${rM}Ø´`;
                }
                grid.innerHTML += `<div class="medal-card ${isDone ? 'active' : ''}"><div><span class="medal-icon">${m.i}</span><div style="font-weight:700; margin-bottom:5px; color:${isDone?'#10b981':m.c}">${m.n}</div><div style="font-size:0.8rem; color:#94a3b8;">${isDone ? 'âœ… Ù…Ø³ØªØ­Ù‚Ø©' : 'Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: '+d.toLocaleDateString('en-GB')}</div>${!isDone ? `<div style="font-size:0.75rem; color:#6c757d; margin-top:5px; font-weight:700;">${remTxt}</div>` : ''}<div class="medal-progress-bar"><div class="medal-progress-fill" style="width:${isDone ? '100' : Math.min(100, (tY/m.y)*100)}%; background:${isDone ? '#10b981' : m.c}"></div></div></div>`;
            });

            const birth = parseDateSafe(w.birth);
            const retire = new Date(birth); retire.setFullYear(retire.getFullYear() + 60);
            document.getElementById('retire-date').innerText = retire.toLocaleDateString('en-GB');
            let rDiff = retire - today;
            if(rDiff > 0) {
                let rY = Math.floor(rDiff / (1000 * 60 * 60 * 24 * 365.25));
                let rM = Math.floor((rDiff % (1000 * 60 * 60 * 24 * 365.25)) / (1000 * 60 * 60 * 24 * 30.44));
                let rD = Math.floor((rDiff % (1000 * 60 * 60 * 24 * 30.44)) / (1000 * 60 * 60 * 24));
                document.getElementById('retire-countdown').innerText = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${rY} Ø³Ù†Ø© Ùˆ ${rM} Ø´Ù‡Ø± Ùˆ ${rD} ÙŠÙˆÙ…`;
            } else { document.getElementById('retire-countdown').innerText = "Ù…ØªÙ‚Ø§Ø¹Ø¯"; }
        }

        window.onload = () => {
            initShiftSystem();
            switchApp('shift');
            setDateConstraints(); // ØªÙØ¹ÙŠÙ„ Ù‚ÙŠÙˆØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        };
    </script>
</body>
</html>
